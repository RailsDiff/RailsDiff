---
name: "Default"

"on":
  "push":
    "branches":
      - "main"

jobs:
  tests:
    name: "Tests"
    runs-on: "${{ matrix.os }}"
    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-node@v1"
        with:
          node-version: "${{ matrix.node-version }}"
      - uses: "actions/cache@v2"
        with:
          path: "~/.npm"
          key: "${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}"
          restore-keys: |
            ${{ runner.os }}-node-
      - name: "Install Dependencies"
        run: "npm install"
      - name: "Run Tests"
        run: "npm test"
    strategy:
      matrix:
        os:
          - "ubuntu-latest"
        node-version:
          - "14.x"
  deploy:
    name: "Deployment"
    needs: tests
    runs-on: "ubuntu-latest"
    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-node@v1"
        with:
          node-version: "14.x"
      - uses: "actions/cache@v2"
        with:
          path: "~/.npm"
          key: "${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}"
          restore-keys: |
            ${{ runner.os }}-node-
      - run: "npm install"
      - run: "npm run build"

      - uses: 'netlify/actions/cli@master'
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        with:
          args: "deploy --dir=dist --prod"
          secrets: '["NETLIFY_AUTH_TOKEN", "NETLIFY_SITE_ID"]'
